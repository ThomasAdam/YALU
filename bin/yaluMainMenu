#!/bin/bash

# Returns the FVWM config data which represents the the most apropriate icon for
# the given program name
function pickIcon {
	if [ -f "$YALU/images/$yaluTheme/$1.$yaluImageType" ]; then
		echo "%$YALU/images/$yaluTheme/$1.$yaluImageType%"
	elif [ -f "$YALU/images/$yaluTheme/$2.$yaluImageType" ]; then
		echo "%$YALU/images/$yaluTheme/$2.$yaluImageType%"
	fi
} # function pickIcon

# Echos the fvwm command to add a launcher item:
#   $1: Menu text
#   $2: Command
function echoAddLauncherItem {
	echo "AddToMenu launcher \"$1\" Exec eval $YALU/bin/yaluAppRun \"$2\""
	
	# If this element has a shortcut key, assign it
	if echo "$1" | grep -q "&" ; then
		shortcut="$(echo "$1" | sed -re "s/.*(&([[:alpha:]])).*/\2/")"
		echo "Key $shortcut A 4 Exec eval $YALU/bin/yaluAppRun \"$2\""
	fi
}

 #########
## Reset ##
 #########
	echo "DestroyMenu recreate launcher"
	echo "AddToMenu launcher \"Launch\" Title"

 ######################
## Basic Applications ##
 ######################
	# Terminal
	terminalIcon="$(pickIcon "xterm" "terminal")"
	echoAddLauncherItem "$terminalIcon&Terminal" "$yaluTerminal"

	# Web Browser
	browserIcon="$(pickIcon "$yaluBrowser" "browser")"
	echoAddLauncherItem "$browserIcon&Web Browser" "$yaluBrowser"

	# Editor
	editorIcon="$(pickIcon "$yaluEditor" "editor")"
	echoAddLauncherItem "$editorIcon&Editor" "$yaluEditor"

	# Run (Dmenu)
	echo "Key Space A 4 Exec exec \"\$[YALU]/bin/yaluDmenuProgramList\""

 #####################
## User Applications ##
 #####################
	echo "AddToMenu launcher \"\" nop"
	cat "$YALU/menu" | while read menuData; do
		if [ "$menuData" != "" ]; then
			if echo "$menuData" | grep -q "	"; then
				menuText="$(echo "$menuData" | sed -re "s/^([^	]*)	(.*)/\1/")"
				menuCommand="$(echo "$menuData" | sed -re "s/^([^	]*)	(.*)/\2/")"
			else
				menuText="$menuData"
				menuCommand="$(echo "$menuData" | sed -re "s/&//")"
			fi
			menuIcon="$(
				pickIcon "$(echo "$menuCommand" | sed -re "s/^([[:alnum:]]*).*$/\1/")"
			)"
			echoAddLauncherItem "${menuIcon}$menuText" "$menuCommand"
		else
			echo "AddToMenu launcher \"\" nop"
		fi
	done

 ########
## Quit ##
 ########
	echo "AddToMenu launcher \"\" nop"

	icon="$(pickIcon "exitButton")"
	echo "AddToMenu launcher \"${icon}E&xit YALU\" Quit"

